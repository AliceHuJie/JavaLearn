#一、索引原理
帮助Mysql高效获取数据的排好序的数据结构([数据结构教学网站](https://www.cs.usfca.edu/~galles/visualization/Algorithms.html))   
存储在文件里  
索引结构（二叉树，红黑树，Hash, **_Btree_**）

为什么用Btree作为索引，而不是二叉树，红黑树等 ？ 
- 二叉树作为索引
![二叉树](../../../../../resources/images/mysql/索引.png)
  &emsp;但是当数据升序或者降序时，二叉树就退化成了链表,树深度高 
- 红黑树  
![红黑树](../../../../../resources/images/mysql/红黑树.png)   
  &emsp;红黑树是一个二叉平衡树，自动平衡功能相对二叉树单边增长的情况会更好  
  &emsp;但是红黑树是一种二叉树，当数据量大的时候，树的深度很高，当要查的数据在叶子节点时，会需要很多次磁盘IO操作,查找速度不够快
- Hash  
  &emsp;查询速率快  
  &emsp;等值查询快，但是范围查询：例如>6
  
- Btree  
![Btree](../../../../../resources/images/mysql/Btree.png)   
  &emsp; 通过增加树的度数，横向扩展，降低树的高度。几百万的数据甚至可以控制到3-5层。  
  叶节点具有相同的深度  
  叶节点的指针为空  
  叶节点的数据从左向右自增  
  
   &emsp;通过几次找到节点，整个节点数据载入内存，再在内存中进行随机访问找到数据。速度非常快。  
  
   &emsp;是不是度数越大，让树的深度为1的时候最好呢？？
  
- B+Tree  



Mysql中建索引时，可以选择索引类型是Hash或者Btree(一般Hash使用较少)
磁盘数据存储以页为单位，磁盘与内存的交互也是以页为单位。  
-》 B+Tree的节点大小不能过大，需要最好能一次IO就读入内存
-》因此B+Tree的度不能无限的大
mysql 一般会把一个索引节点的大小设置为1页，例如16K

当非叶子节点只存索引，不存数据时，在每个索引节点大小限定（例如1页）的情况下，每个小索引节点占用的大小越小，小索引节点
的数量更多，树的度也就更多，树高度更小，查询时IO次数更少。

叶子节点作为最后一层节点，存储数据不影响IO次数。（叶子层节点中还有从左向右的指针）  
![Btree](../../../../../resources/images/mysql/叶子节点存数据.png)   
非叶子节点的索引做了冗余（如图中15），非叶子节点的数据移到了叶子节点  

B+ tree的度一般会超过100，高度3-5.  

# 二、基于原理分析存储引擎  
说明：存储引擎是在表级别的（建表时可以指定），不是数据库级别
### MYISAM 索引实现
底层数据与索引分开存储（非聚集）
![Btree](../../../../../resources/images/mysql/myisam.png)  
基于主键的查找：先通过索引找到文件指针，再通过指针去数据文件对应位置查找数据  
普通索引查找与通过主键的查找是相同的。都是叶子节点存储的指针。  
总结： 对于Myiasm, 主键索引和普通索引查找数据没太大区别

### innoDb索引实现 （聚集）
聚集索引是指数据与索引放在一起，innoDb存储引擎的主键索引就是聚集索引。
![Btree](../../../../../resources/images/mysql/innodb.png)  
对于主键索引，叶子节点存储的是完整数据（与myisam存储指针不同）  
对于非主键索引，叶子节点存储的是主键索引的值，利用非主键索引时，会先查到到主键索引值，然后再去主键索引中二次索引，最终查找到数据值  


Qus: 
1. 为什么innodb必须有主键，且推荐使用整型的自增主键？
innoDB的数据文件是按主键进行组织的，如果不建主键，innoDB会自动选一列合适的作为主键或自动生成主键；  

uuid比自增整型浪费空间。索引查找过程中数值的比较优于字符串比较。B+树叶子节点是根据主键索引从左到右自增的。

2. 为什么非主键索引的叶子节点存储的是主键索引的值？  
一致性和存储空间



